<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	
    <title>地图</title>
    
        #parse("sys/header.html")
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=3.0&ak=ICtHAcsMhciEVa3vhYirZV9GgBdySEwH" charset="utf-8"></script>
     <style>
 		html{height:100%}  
        body{height:100%;margin:0px;padding:0px}  
        #container{width:100%;height:100%}  
</style>
</head>
<body>  
<div id="container"></div> 
<script type="text/javascript"> 

$(function () {
	let address = getQueryString("address");
	console.log(address);
	var map = new BMap.Map("container");          // 创建地图实例  
	var point = new BMap.Point(116.404, 39.915);  // 创建点坐标  
	map.centerAndZoom(point, 15);                 // 初始化地图，设置中心点坐标和地图级别     
	map.enableScrollWheelZoom(true);
	var local = new BMap.LocalSearch(map, {
		renderOptions:{map: map}
	});
	local.search(address);
});

var map = new BMap.Map("container");          // 创建地图实例  
var point = new BMap.Point(116.404, 39.915);  // 创建点坐标  
map.centerAndZoom(point, 15);                 // 初始化地图，设置中心点坐标和地图级别     
map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放
//通过ip定位
function myFun(result){
	var cityName = result.name;
	map.setCenter(cityName);
}
var myCity = new BMap.LocalCity();
myCity.get(myFun);

//  定义一个控件类，即function    
function SearchControl(){    
    // 设置默认停靠位置和偏移量  
    this.defaultAnchor = BMAP_ANCHOR_TOP_LEFT;    //相对于左上角
    this.defaultOffset = new BMap.Size(100, 20);    //相对于图标左上角的位置
}    
// 通过JavaScript的prototype属性继承于BMap.Control   
SearchControl.prototype = new BMap.Control();
// 自定义控件必须实现initialize方法，并且将控件的DOM元素返回   
// 在本方法中创建个div元素作为控件的容器，并将其添加到地图容器中   
SearchControl.prototype.initialize = function(map){
	var div = $("<div><font size='2'>关键字</font><input id='mytext' type='text'><input id='mybtn' type='button' value='查询'></div");
		$(map.getContainer()).append(div);//将以上的html添加到地图中覆盖
		$("#mybtn").css("border-radius", 8);//设置按钮圆角
		$("#mybtn").on("click", function() { //按钮点击后 调用api搜索
			var val = $("#mytext").val();
			var local = new BMap.LocalSearch(map, {
				renderOptions : {
					map : map
				}
			});
			local.search(val);
		});
		// 将DOM元素返回  
		return div[0];
	}
	//var marker = new BMap.Marker(new BMap.Point(116.404, 39.915)); // 创建点
	//marker.addEventListener("click",attribute);
	//map.addOverlay(marker);    //增加点

	//用经纬度设置地图中心点
	function theLocation(longitude,latitude){
		map.clearOverlays(); 
		var new_point = new BMap.Point(longitude,latitude);
		var marker = new BMap.Marker(new_point);  // 创建标注
		map.addOverlay(marker);              // 将标注添加到地图中
		map.panTo(new_point);    
	}

	//地图点击事件 获取经纬度
	map.addEventListener("click", function() {
		var center = map.getCenter();
		//theLocation(center.lng,center.lat);
		// alert("地图中心点变更为：" + center.lng + ", " + center.lat);
	});
	
	
	
	function attribute(){
		var p = marker.getPosition();  //获取marker的位置
		alert("marker的位置是" + p.lng + "," + p.lat);    
	}
	
	map.addControl(new SearchControl()); //将自定义的控件添加到地图中     
</script>  
</body>  
</html>